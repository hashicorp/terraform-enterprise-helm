{{/*
Copyright IBM Corp. 2023, 2025
SPDX-License-Identifier: MPL-2.0
*/}}

{{- if and .Values.tls.certData .Values.tls.keyData }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.tls.certificateSecret }}
  namespace: {{ .Release.Namespace }}
type: kubernetes.io/tls
data:
  tls.crt: {{ .Values.tls.certData }}
  tls.key: {{ .Values.tls.keyData }}
{{- end }}

{{- if and .Values.tlsSecondary.certData .Values.tlsSecondary.keyData }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.tlsSecondary.certificateSecret | default "terraform-enterprise-certificates-secondary" }}
  namespace: {{ .Release.Namespace }}
type: kubernetes.io/tls
data:
  tls.crt: {{ .Values.tlsSecondary.certData }}
  tls.key: {{ .Values.tlsSecondary.keyData }}
{{- end }}

{{- if and .Values.tlsRedis.certData .Values.tlsRedis.keyData .Values.tlsRedis.caCertData }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.tlsRedis.certificateSecret | default "terraform-enterprise-certificates-redis" }}
  namespace: {{ .Release.Namespace }}
type: kubernetes.io/tls
data:
  tls.crt: {{ .Values.tlsRedis.certData }}
  tls.key: {{ .Values.tlsRedis.keyData }}
  tls.ca: {{ .Values.tlsRedis.caCertData }}
{{- end }}

{{- if and .Values.tlsRedisSidekiq.certData .Values.tlsRedisSidekiq.keyData .Values.tlsRedisSidekiq.caCertData }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.tlsRedisSidekiq.certificateSecret | default "terraform-enterprise-certificates-redis-sidekiq" }}
  namespace: {{ .Release.Namespace }}
type: kubernetes.io/tls
data:
  tls.crt: {{ .Values.tlsRedisSidekiq.certData }}
  tls.key: {{ .Values.tlsRedisSidekiq.keyData }}
  tls.ca: {{ .Values.tlsRedisSidekiq.caCertData }}
{{- end }}

{{- if .Values.tls.caCertData }}
---
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: terraform-enterprise-ca-certificates
  namespace: {{ .Release.Namespace }}
data:
  {{ .Values.tls.caCertFileName }}: {{ .Values.tls.caCertData }}
{{- end }}

---
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: terraform-enterprise-env-secrets
  namespace: {{ .Release.Namespace }}
data:
{{- include "helpers.list-env-secrets" . | indent 2 }}
